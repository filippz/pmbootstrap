From 00220e8c72c421d1b7768ac636371710e960133f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Filip=20Matijevi=C4=87?= <filip.matijevic.pz@gmail.com>
Date: Thu, 24 Dec 2015 16:09:20 +0100
Subject: [PATCH 19/53] media: radio: wl1273: Fix V4L2_CID_TUNE_PREEMPHASIS
 control
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Filip MatijeviÄ‡ <filip.matijevic.pz@gmail.com>
---
 drivers/media/radio/radio-wl1273.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/media/radio/radio-wl1273.c b/drivers/media/radio/radio-wl1273.c
index bf575deef901..f11ab937689d 100644
--- a/drivers/media/radio/radio-wl1273.c
+++ b/drivers/media/radio/radio-wl1273.c
@@ -2100,7 +2100,12 @@ static int wl1273_fm_radio_probe(struct platform_device *pdev)

	radio->videodev.v4l2_dev = &radio->v4l2dev;

-	v4l2_ctrl_handler_init(&radio->ctrl_handler, 6);
+	r = v4l2_ctrl_handler_init(&radio->ctrl_handler, 5);
+	if (r < 0) {
+		dev_err(&pdev->dev, "Can't init ctrl handler\n");
+		v4l2_ctrl_handler_free(&radio->ctrl_handler);
+		return -EBUSY;
+	}

	/* add in ascending ID order */
	v4l2_ctrl_new_std(&radio->ctrl_handler, &wl1273_ctrl_ops,
@@ -2112,7 +2117,7 @@ static int wl1273_fm_radio_probe(struct platform_device *pdev)

	v4l2_ctrl_new_std_menu(&radio->ctrl_handler, &wl1273_ctrl_ops,
			       V4L2_CID_TUNE_PREEMPHASIS,
-			       V4L2_PREEMPHASIS_75_uS, 0x03,
+			       V4L2_PREEMPHASIS_75_uS, 0,
			       V4L2_PREEMPHASIS_50_uS);

	v4l2_ctrl_new_std(&radio->ctrl_handler, &wl1273_ctrl_ops,
--
2.11.0
